#!/usr/bin/env bash
set -euo pipefail

file=$@

jq -c '.[]' "$file" | while IFS= read -r item; do
  image=$(echo $item | jq -r '.image')
  repo_file="${image#registry.redhat.io/openshift4/}"
  repo_file="${repo_file#registry.redhat.io/openshift4-wincw/}"
  sources_folder="sources"
  if [ -f $sources_folder/$repo_file.zip ]; then
    echo "Extracting repo for $repo_file"
    unzip -o -qq $sources_folder/$repo_file.zip -d $sources_folder
    # rm $sources_folder/$repo_file.zip
  fi
done