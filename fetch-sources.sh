#!/usr/bin/env bash
set -euo pipefail

file=$@

sources_folder="sources"
if [ ! -d $sources_folder ]; then
  mkdir $sources_folder
fi

jq -c '.[]' "$file" | while IFS= read -r item; do
  image=$(echo $item | jq -r '.image')
  downloadLocation=$(echo $item | jq -r '.downloadLocation')
  repo_file="${image#registry.redhat.io/openshift4/}"
  repo_file="${repo_file#registry.redhat.io/openshift4-wincw/}"

  if [ ! -f $sources_folder/$repo_file.zip ]; then
    echo "Downloading repo for $repo_file : $downloadLocation"
    wget -q -O $sources_folder/$repo_file.zip $downloadLocation
  fi

done